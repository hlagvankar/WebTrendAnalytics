DROP TABLE CRAWLERS_IP;


CREATE TABLE CRAWLERS_IP
(
FROM_IP STRING,
TO_IP STRING,
WHO STRING
)ROW FORMAT DELIMITED FIELDS TERMINATED BY ',';


LOAD DATA LOCAL INPATH '/home/hive/PROJ/CRAWLERS' INTO TABLE CRAWLERS_IP;


SELECT IP_ADD,TO_DATE(CLICK_TIME) DATE,HOUR(CLICK_TIME) CLICK_HOUR FROM 
PARSE_2ND JOIN
CRAWLERS_IP 
WHERE IP_ADD BETWEEN FROM_IP AND TO_IP;


INSERT INTO TABLE FINAL_OUTPUT
SELECT IP_ADD,DATE,CLICK_HOUR,WHO,'','','','SR_8'
FROM
(

SELECT IP_ADD,TO_DATE(CLICK_TIME) DATE,HOUR(CLICK_TIME) CLICK_HOUR,WHO
FROM
(
SELECT IP_ADD,MIN(CLICK_TIME) CLICK_TIME,hit_bucket,WHO FROM 
PARSE_2ND JOIN
CRAWLERS_IP 
WHERE IP_ADD BETWEEN FROM_IP AND TO_IP
GROUP BY IP_ADD,hit_bucket,WHO
) A
) A;